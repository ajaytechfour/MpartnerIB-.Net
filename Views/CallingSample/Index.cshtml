@{
    ViewBag.Title = "Index.cshtml";
    Layout = "~/Views/Shared/CallCenter.cshtml";
}

<link href="@Url.Content("~/assets/css/jquery-ui.min.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/assets/js/jquery-1.10.2.js")" type="text/javascript"></script>
<script src="@Url.Content("~/assets/js/jquery-ui.min.js")" type="text/javascript"></script>

<script type="text/javascript">

</script>
<style type="text/css">
    .required {
        color: Red;
    }

    table {
        border: 0;
        border-spacing: 0;
        font-size: 0.857em;
        margin: 10px 0;
        width: 100%;
    }

        table table {
            font-size: 1em;
        }

    #footer-wrapper table {
        font-size: 1em;
    }

    table tr th {
        background: #757575;
        background: rgba(0, 0, 0, 0.51);
        border-bottom-style: none;
    }

        table tr th,
        table tr th a,
        table tr th a:hover {
            color: #FFF;
            font-weight: bold;
        }

    table tbody tr th {
        vertical-align: top;
    }

    tr td,
    tr th {
        padding: 4px 9px;
        border: 1px solid #fff;
        text-align: left; /* LTR */
    }

    #footer-wrapper tr td,
    #footer-wrapper tr th {
        border-color: #555;
        border-color: rgba(255, 255, 255, 0.18);
    }

    tr.odd {
        background: #e4e4e4;
        background: rgba(0, 0, 0, 0.105);
    }

    tr,
    tr.even {
        background: #efefef;
        background: rgba(0, 0, 0, 0.063);
    }

    table ul.links {
        margin: 0;
        padding: 0;
        font-size: 1em;
    }

        table ul.links li {
            padding: 0 1em 0 0;
        }

    .DragMe:Hover {
        cursor: move;
    }

    a#updateThisTable {
        display: none;
    }

     a#cancelThisTable {
        display: none;
    }

    #inputElement {
        display: none;
    }


     input[type=text], select, textarea{
  width: 90%;
  padding: 4px;
  border: 1px solid #ccc;
  resize: vertical;
  font-size:10px;
}

     #resTbl{
         display: none
     }

    
</style>

<script type="text/javascript">
    //Grid Swapping//

    $(function () {

        $("#sbt").hide();

        $.post("@Url.Content("~/CallingSample/getSerialNum")", null, function (data) { SetGrid(data); }, "Json");
        @*$.post("@Url.Content("~/ProductCategory/GetParentCategory")", null, function (data) { SetParentCategory(data); }, "Json");
            $.post("@Url.Content("~/Banner/GetRedirectPage")", null, function (data) { SetRedirectPage(data); }, "Json");*@
    });



    function SetGrid(data) {



        $("#div_gridview").hide();
        if (data == "Login") {
            location.href = "@Url.Content("~/Logout/Logout")";
        }
        else if (data == "snotallowed") {
            location.href = "@Url.Content("~/snotallowed/snotallowed")";
        }
        else {

            var body = "";
            $("#Grid tbody").empty();
            var get_obj_length = data.length;
            var count = 1;
            for (i = 0; i < get_obj_length; i++) {



                body += "<tr><td>" + count + "</td>" +
             "<td>" + data[i].Product_Serial_Number + "</td>" +

            "<td><a style='cursor:pointer' onclick=View('" + data[i].Product_Serial_Number + "');>View</a></td></tr>";
                count++;
            };
            $("#Grid tbody").append(body);
            // SetPages(data.TotalRecord);



        }

    }
    function View(serialno) {

        $.post("@Url.Content("~/CallingSample/Viewdata")", { serialno: serialno }, function (data) { SetviewGrid(data); }, "Json");
    }
    function SetviewGrid(data) {
        $("#sbt").hide();
        $("tbody#updatedResponse").html("");
        $("#resTbl").hide("");
        $("#div_gridview").show();
        $("#GridViewData").show()
        if (data == "Login") {
            location.href = "@Url.Content("~/Logout/Logout")";
        }
        else if (data == "snotallowed") {
            location.href = "@Url.Content("~/snotallowed/snotallowed")";
        }
        else {

            var body = "";
            $("#GridViewData tbody").empty();
            var get_obj_length = data.length;

            for (i = 0; i < get_obj_length; i++) {

                var rowDateString = '"' + data[i].Product_Purchase_Date + '"';

                var mySubString = rowDateString.substring(
rowDateString.lastIndexOf("(") + 1,
rowDateString.lastIndexOf(")")
);
                console.log(mySubString);
                var safeDate = new Date(parseInt(mySubString));
                var mm = safeDate.getMonth() + 1;
                var y = safeDate.getFullYear();
                var dd = safeDate.getDate();

                var purchasedate = dd + "-" + mm + "-" + y;
                var today = y + "-" + (mm) + "-" + (dd);

                var day = ("0" + dd).slice(-2);
                var month = ("0" + (mm)).slice(-2);
                var today = y + "-" + (month) + "-" + (day);



                body += "<tr><td id='oldsn' width='20px'>" + data[i].Product_Serial_Number + "</td>" +
             "<td id='oldprd' width='80px'>" + data[i].Product_Type + "</td>" +
             "<td id='oldcutn'>" + data[i].Customer_Name + "</td>" +
             "<td id='oldpn'>" + data[i].Customer_Phone + "</td>" +
              "<td id='oldaddr'>" + data[i].Customer_Address + "</td>" +
              "<td id='oldcldNew'>" + purchasedate + "</td>" +
            "<td><a style='cursor:pointer;display:inline' id='editthisTable' onclick=Edit('" + data[i].Product_Serial_Number + "');>Edit</a>" +
            "&nbsp;&nbsp <a style='cursor:pointer;display:none' id='updatethisTable' onclick=UpdateF('" + data[i].Product_Serial_Number + "');>Update</a>" +
            "&nbsp;&nbsp <a style='cursor:pointer;display:none' id='cancelthisTable' onclick=CancelF('" + data[i].Product_Serial_Number + "');>Cancel</a>" +
            "</td></tr><tr id='inputElement'><td><input type='text' disabled name='serialNumber' id='serialNumber' value='"+data[i].Product_Serial_Number+"'/></td><td>"+
            "<input type='text' name='product' id='product' value='"+data[i].Product_Type+"'/></td><td>"+
            "<input type='text' name='customerName' id='customerName' value='"+data[i].Customer_Name+"'/></td>"+
            "<td><input type='text' name='phoneNumber' id='phoneNumber' value='"+data[i].Customer_Phone+"' /></td>"+
            "<td><textarea name='address' id='address'>"+data[i].Customer_Address+"</textarea></td>"+
            "<td><input type='date' name='callingDate' id='callingDate' value='"+today+"' /></td><td></td></tr>";

            };
            $("#GridViewData tbody").append(body);

            // SetPages(data.TotalRecord);

        }
    }

    function Edit(serialno) {

        $("a#updatethisTable").show();
        $("a#cancelthisTable").show();
        $("a#editthisTable").hide();
        $("#inputElement").show();
    }

    function UpdateF() {



        var sn = ($("#serialNumber").val()).trim();
        var prd = ($("#product").val()).trim();
        var cutn = ($("#customerName").val()).trim();
        var pn = ($("#phoneNumber").val()).trim();
        var addr = ($("#address").val()).trim();
        var date = new Date($('#callingDate').val());
        day = date.getDate();
        month = date.getMonth() + 1;
        year = date.getFullYear();
        var cldNew = day + "-" + month + "-" + year;
        bodyStr = '';


        newData = {
            'sn': sn,
            'prd': prd,
            'cutn': cutn,
            'pn': pn,
            'addr': addr,
            'cldNew':cldNew
        }

        bodyStr += "<tr><td id='chngsn'>" + sn + "</td>" +
                    "<td id='chngprd'>" + prd + "</td>" +
                    "<td id='chngcutn'>" + cutn + "</td>" +
                    "<td id='chngpn'>" + pn + "</td>" +
                     "<td  id='chngaddr'>" + addr + "</td>" +
                     "<td id='chngcldNew'>" + cldNew + "</td>" +
                   "</tr>";

        $("tbody#updatedResponse").html("");
        $("tbody#updatedResponse").append(bodyStr);

        $("a#updatethisTable").hide();
        $("a#cancelthisTable").hide();
        $("a#editthisTable").show();

        $.post("@Url.Content("~/CallingSample/Update")", { serialno: sn, prdtype: prd, custname: cutn, custphone: pn, custaddress: addr, saledate: cldNew }, function (data) { saveupdate(data); }, "Json");

        updateWithColor(newData);

        // It will fire after getting success reponse from ajax

    }

    function saveupdate(data)
    {
        alert(data);
        if(data=="Record Updated Successfully")
        {
            $("#resTbl").show();
        }

    }

    function CancelF(serialno) {

        $("#serialNumber").val($("#oldsn").text());
        $("#product").val($("#oldprd").text());
        $("#customerName").val($("#oldcutn").text());
        $("#phoneNumber").val($("#oldpn").text());
        $("#address").val($("#oldaddr").text());
        //$("#callingDate").val();

        $("a#updatethisTable").hide();
        $("a#cancelthisTable").hide();
        $("a#editthisTable").show();
        $("#inputElement").hide();
    }


    function updateWithColor(data) {

        for (var i in data) {
            var oldData = ($("#old" + i).text()).trim();
            var newData = data[i]; //alerts key's value

            if (oldData != newData) {
                $("#chng" + i).attr("style", "background:green");
            }

        }

        $("#sbt").show();


    }


    $("body").on("click", "#sbt", function () {

        $("#div_gridview").hide();
        $("#resTbl").hide();

        $("#sbt").hide();
        $.post("@Url.Content("~/CallingSample/getSerialNum")", null, function (data) { SetGrid(data); }, "Json");

    });

    $(document).ready(function () {
        $("#search").on("keyup", function () {
            var value = $(this).val();
           
            $("body").find("#Grid tr").each(function (index) {
                if (index !== 0) {
                    
                    $row = $(this);

                    var id = $row.find("td").eq(1).text();

                    if (id.indexOf(value) !== 0) {


                        $row.hide();
                    }
                    else {
                        $row.show();
                    }
                }
            });
        });
    });

    </script>

<div id="content_wrap">





    <div class="msgbar msg_Info heading">
        Calling Sample
    </div>

    <input type="text" id="search" placeholder="Search" style="width:200px;margin-top:10px;float:right" />
    <br /><br />

    <div style="height: 300px;overflow: scroll;">
        @*<div id="list" sc style="width:100%;height:200px;overflow-y: scroll;">*@




        <table id="Grid">
            <thead>
                <tr>
                    <th>
                        ID
                    </th>
                    <th>
                        Serial No.
                    </th>
                    <th>
                        Action
                    </th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

    </div>

    <div id="div_gridview">
        @*<div id="list" sc style="width:100%;height:200px;overflow-y: scroll;">*@

        <table id="GridViewData" >
            <thead>
                <tr>

                    <th>
                        Serial Number
                    </th>
                    <th>
                        Product
                    </th>
                    <th>
                        Customer Name
                    </th>
                    <th>
                        Phone Number
                    </th>
                    <th>
                        Address
                    </th>
                    <th>
                        Date Of Sale
                    </th>
                    <th>
                        Action
                    </th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <br /><br />


        @*<table id="resTbl" style="width:80% !important;">*@
            <table id="resTbl">

                <caption style="font:bolder;margin-bottom:10px">Updated Data</caption>
                <thead>
                    <tr>

                        <th>
                            Serial Number
                        </th>
                        <th>
                            Product
                        </th>
                        <th>
                            Customer Name
                        </th>
                        <th>
                            Phone Number
                        </th>
                        <th>
                            Address
                        </th>
                        <th>
                            Date Of Sale
                        </th>

                    </tr>
                </thead>
                <tbody id="updatedResponse"></tbody>
            </table>
        <div style="text-align:center">


            <button id="sbt">Submit</button>
        </div>
    </div>
</div>